{% load staticfiles %}
<!DOCTYPE html>

<html lang="en">

    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- The above 3 meta tags must come first in the head; any other head content must come after these tags -->
        <meta name="description" content="">
        <meta name="author" content="">

        <link rel="icon" href="{% static '/sample/logo-icon.png' %}">
        <title>Shopping Cart</title>

        <!-- Using Bootstrap CDN (Content Delivery Network) so no need to personally download and host Bootstrap -->
        <!-- Requires internet access -->
        <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
        <!-- jQuery library -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
        <!-- Latest compiled JavaScript -->
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        <!-- Custom styles -->
        <link href="{% static '/style/main.css' %}" rel="stylesheet">
        <link href="{% static '/style/game.css' %}" rel="stylesheet">
    </head>

    <body>

        {% include 'vapoursite/header.html' %}


        {% if not user.is_authenticated %}

        <h1>Log in or Register with the Fume Community Platform to purchase games!</h1>

        {% else %}

        <div class="container game-short">

            <div class="row vcenter">
                <div class="col-md-3">
                    <h1>Shopping Cart:</h1>
                </div>
                <div class="col-md-5">
                    <p align="right">
                        <b>Rewards received from this purchase</b>: {{ reward_rcv }}<br>
                        <b>Spending needed for next Reward</b>: $ {{ user.get_needed_spending }}
                    </p>
                </div>
                <div class="col-md-3">
                    <p align="right">
                        <font size="5"><b>Rewards Left: </b>{{ user.get_available_reward_count }}</font>
                    </p>
                </div>
                <div class="col-md-1"></div>
            </div><hr><!-- /Title and Information about rewards -->

            <div class="row vcenter">
                <div class="col-md-4">
                    <h3>Title</h3>
                </div>
                <div class="col-md-1">
                    <h3>Platform</h3>
                </div>
                <div class="col-md-2">
                    <h3 align="right">Original</h3>
                </div>
                <div class="col-md-1">
                    <h3>Rewards</h3>
                </div>
                <div class="col-md-2">
                    <h3 align="right">Price</h3>
                </div>
                <div class="col-md-3"></div>
            </div><hr><!-- /Shopping cart information headers -->

            {% if not cart %}

                <div class="row vcenter">
                    <div class="col-md-12">
                        <h1>Your cart is empty. Please choose some games to add to your cart.</h1>
                    </div>
                </div>

            {% else %}

                {% for entry in cart %}
                <div class="row vcenter">
                    <div class="col-md-4">
                        <a href="/game/{{ entry.game.id }}/">
                            <p>{{ entry.game.title }}</p>
                        </a>
                    </div>
                    <div class="col-md-1">
                        <p>{{ entry.platform }}</p>
                    </div>
                    <div class="col-md-2">
                        <p align="right">${{ entry.price }}</p>
                    </div>
                    <div class="col-md-1">
                        <p align="right">{{ entry.rewards_used }}</p>
                    </div>
                    <div class="col-md-2">
                        <p align="right">${{ entry.get_discount_price }}</p>
                    </div>
                    <div class="col-md-1">
                        <form method='post' action=''>{% csrf_token %}
                            <div class="user-options">
                                <button class="btn" type="submit" value="{{ entry.id }}" name="addReward">Add</button>
                            </div>
                        </form>
                    </div>
                    <div class="col-md-1">
                        <form method='post' action=''>{% csrf_token %}
                            <div class="user-options">
                                <button class="btn" type="submit" value="{{ entry.id }}" name="removeReward">Remove</button>
                            </div>
                        </form>
                    </div>
                    <div class="col-md-1">
                        <a href="/cart/delete/{{ entry.id }}/">
                            <span class="glyphicon glyphicon-remove"/>
                        </a>
                    </div>
                </div><hr><!-- /Game entry in cart -->
                {% endfor %}

                <div class="row vcenter">
                    <div class="col-md-5"></div>
                    <div class="col-md-2">
                        <h4 align="center"><b>$ {{ pretotal }}</b></h4>
                    </div>
                    <div class="col-md-1">
                        <h4 align="left"><b>{{ reward_tot }}</b></h4>
                    </div>
                    <div class="col-md-2">
                        <h2 align="left"><b>$ {{ postotal }}</b></h2>
                    </div>
                    <div class="col-md-2"></div>
                </div><!-- /Subtotals -->

                <div class="row vcenter">
                    <div class="col-md-1">
                        <div class="user-options">
                            <form method="post" action="/cart/empty/">{% csrf_token %}
                                <button class="btn btn-lg" type="submit">Empty Cart</button>
                            </form>
                        </div>
                    </div>
                    <div class="col-md-7"></div>
                    <div class="col-md-3">
                        <div class="user-options">
                            <form method="post" action="/cart/checkout/">{% csrf_token %}
                                <button class="btn btn-lg" type="submit">Checkout</button>
                            </form>
                        </div>
                    </div>
                    <div class="col-md-1"></div>
                </div><!-- /Checkout and Empty Cart buttons -->

            {% endif %}<!-- /If cart has contents -->

            </div>

        {% endif %}<!-- /If user is logged in -->

        {% include 'vapoursite/footer.html' %}

    </body>
</html>
